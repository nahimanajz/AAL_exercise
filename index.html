<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Udacity UI and Redux</title>
</head>
<body>
    <div>
        <h1>TODO List</h1>
        <input type="text" id="todo" placeholder="Add to do">
        <button type="button" id="todoBtn">Add To DO</button>
        <ul id="todos">

        </ul>
    </div>
    <div>
        <h1>Goals List</h1>
        <input type="text" id="goal" placeholder="Goal Btn">
        <button type="button" id="goalBtn">Add a Goal</button>
        <ul id="goals">

        </ul>
    </div>
    
    <script type="text/javascript">
        const generateId = () => Math.random().toString(32).substring(2) + (new Date()).getTime().toString(36)
        // Library Code
        function createStore (reducer) {
        let state
        let listeners = []
        const getState = () => state
        const subscribe = (listener) => {
            listeners.push(listener)
            return () => {
            listeners = listeners.filter((l) => l !== listener)
            }
        }

        const dispatch = (action) => {
            state = reducer(state, action)
            listeners.forEach((listener) => listener())
        }
        return { getState, subscribe, dispatch };
        }

        // App Code
        const ADD_TODO = 'ADD_TODO'
        const REMOVE_TODO = 'REMOVE_TODO'
        const TOGGLE_TODO = 'TOGGLE_TODO'
        const ADD_GOAL = 'ADD_GOAL'
        const REMOVE_GOAL = 'REMOVE_GOAL'

        function addTodoAction (todo) {
        return {
            type: ADD_TODO,
            todo,
        }
        }
        function toggleTodoAction(id) {
            return { type:TOGGLE_TODO, id };
        }
        function addGoalAction (goal) {
        return {
            type: ADD_GOAL,
            goal,
        }
        }
        function removeTodoAction (id) { //todo id
            return { type: REMOVE_TODO, id}
        }
        function removeGoalAction (id) { //goal id
            return { type: REMOVE_TODO, id}
        }
   
        function goals (state = [], action) {
        switch(action.type) {
            case ADD_GOAL :
            return state.concat([action.goal])
            case REMOVE_GOAL :
            return state.filter((goal) => goal.id !== action.id);
            default :
            return state
        }
        }
        function todos (state = [], action) {
           
            switch(action.type) {
            case ADD_TODO :
            return state.concat([action.todo])
            case REMOVE_TODO :
            return state.filter((todo) => todo.id !== action.id);
            case TOGGLE_TODO :
            return state.filter((todo) => todo.id !== action.id ? todo:
                Object.assign({}, todo, {complete: ! todo.complete}));
           
            default :
            return state
        }
            }

        function reducers (state = {}, action) {
        return {
            todos: todos(state.todos, action),
            goals: goals(state.goals, action),
        }
        }
        const store = createStore(reducers);
        store.subscribe(() => {
            const { goals, todos } = store.getState();
            document.getElementById('goals').innerHTML = '';
            document.getElementById('todos').innerHTML = '';

            goals.forEach(addTodoToDOM);
            todos.forEach(addGoalTodom);
        });
        
        function addToDo() {
            
            const input =  document.getElementById('todo');
            const name = input.value;
            input.value= ' ';

            store.dispatch(addTodoAction({ name, complete:false, id: generateId()  }));
        }
        function addGoal() {            
            const input =  document.getElementById('goal');
            const name = input.value;
            input.value= ' ';
            store.dispatch(addGoalAction({ name, id: generateId()  }));
        }
        function addTodoToDOM(todo){
            const node = document.createElement('li');
            const text = document.createTextNode(todo.name)
            const rmButton = createRemoveButton( ()=> {                              
                store.dispatch(removeTodoAction(todo.id));
            });
            node.appendChild(text);
            node.style.textDecoration = todo.complete ? 'line-through': 'none';
            node.addEventListener('click',() => store.dispatch(toggleTodoAction(todo.id)));
            node.appendChild(rmButton);
            document.getElementById('goals').appendChild(node);
            
        }
        function addGoalTodom(goal){
            const node = document.createElement('li');
            const text = document.createTextNode(goal.name)
            node.appendChild(text);
            const rmButton = createRemoveButton(()=>{                
                store.dispatch(removeGoalAction(goal.id))
            });
            node.appendChild(rmButton);
            document.getElementById('goals').appendChild(node);
        }
        
        function createRemoveButton(onClick){
            const removeBtn = document.createElement('button')
            removeBtn.innerHTML = 'X'
            removeBtn.addEventListener('click', onClick);
            return removeBtn;
        }
        document.getElementById('todoBtn').addEventListener('click', addToDo);
        document.getElementById('goalBtn').addEventListener('click', addGoal);
        
</script> 
</body>
</html>


